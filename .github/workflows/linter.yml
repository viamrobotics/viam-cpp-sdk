name: cpp-linter

on: pull_request

jobs:
  cpp-linter:
    if: github.repository_owner == 'viamrobotics'
    runs-on: [self-hosted, x64]
    container:
      image: ghcr.io/viamrobotics/canon:amd64
    steps:
      - name: Checkout PR/Push/Workflow Dispatch
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
      - name: Run linter
        uses: github/super-linter/slim@v4
        env:
          VALIDATE_ALL_CODEBASE: false
          VALIDATE_CPP: true
          FILTER_REGEX_EXCLUDE: .*src/gen/.*
          DEFAULT_BRANCH: main
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
